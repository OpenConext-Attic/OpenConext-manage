<div id="<?php $this->id = 'datagrid'; echo $this->id; ?>"></div>

<script type="text/javascript" src="/javascript/coinmanage.ajaxdatatables.js"></script>
<script type="text/javascript" src="/javascript/yui.surfconext.formatters.js"></script>
<script type="text/javascript">
<?php
    // Format the column config for export to json
    $fields = array();
    $columnsDefinition = $this->config->columns->toArray();
    foreach ($columnsDefinition as $key => $definition) {
        $definition['key'] = $key;
        if (!isset($definition->hidden) || $definition->hidden !== true) {
            $fields[] = $key;
        }
        $columnsDefinition[] = $definition;
        unset($columnsDefinition[$key]);
    }
?>

COINMANAGE.AjaxDataTable('#<?php echo $this->id; ?>').
    setLoadUrl('<?php echo $this->url(array('format'=>'json'));?>/?').
    setLoadFields(<?php echo json_encode($fields); ?>).
    setDisplayColumns(<?php echo json_encode($columnsDefinition); ?>).
<?php if (isset($this->config->editable) && $this->config->editable): ?>
    onRecordClick(function(DataTable) {
        // Some magic to get the id of the row the use selected
        var id = DataTable.getRecord(DataTable.getSelectedRows()[0]).getData('id');
        window.location.href = '<?php echo $this->url($this->config->edit->url->toArray()); ?>?id=' + id;
    }).
<?php endif; ?>
<?php if (isset($this->config->pageSize)) : ?>
    setLimit(<?php echo $this->config->pageSize; ?>).
<?php endif; ?>
<?php if (isset($this->config->deletable) && $this->config->deletable) : ?>
    addRecordAction('delete', {
        imgAlt: 'delete',
        imgSrc: '/images/icon_trashcan.gif',
        onClick: function(el, record, DataTable) {
            if (!window.confirm('Verwijder rij?')) {
                return false;
            }

            var myDataSource = new YAHOO.util.DataSource(
                '<?php echo $this->url(array('action'=>'delete')); ?>?'
            );
            myDataSource.sendRequest('id=' + record.getData('id'), {
                success : function() {
                    window.location.reload();
                }
            });
        }
    }).
<?php endif; ?>
<?php if (isset($this->config->actions) && !empty($this->config->actions)): ?>
    <?php foreach ($this->config->actions as $actionConfig): ?>
    addRecordAction('<?php echo $actionConfig->name;?>', {
        <?php if (isset($actionConfig->imgAlt)): ?>
        "imgAlt": <?php echo json_encode($actionConfig->imgAlt); ?>,
        <?php endif; ?>
        <?php if (isset($actionConfig->imgSrc)): ?>
        "imgSrc": <?php echo json_encode($actionConfig->imgSrc); ?>,
        <?php endif; ?>
        <?php if (isset($actionConfig->url)): ?>
        "href": <?php echo json_encode($this->url($actionConfig->url->toArray())); ?>,
        <?php endif; ?>
        "dummyForTrailingComma": ''
    }).
    <?php endforeach; ?>
<?php endif; ?>
<?php if (isset($this->config->defaultSortField)): ?>
    setSortedBy('<?php echo $this->config->defaultSortField; ?>').
<?php endif; ?>
<?php if (isset($this->config->defaultSortDir)): ?>
    setSortedDir('<?php echo $this->config->defaultSortDir; ?>').
<?php endif; ?>
    render();
</script>